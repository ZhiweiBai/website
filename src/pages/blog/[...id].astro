---
import { getCollection, render } from 'astro:content'
import dayjs from 'dayjs'
import utc from 'dayjs/plugin/utc'
import BlogPost from '../../layouts/BlogPost.astro'

dayjs.extend(utc)

export async function getStaticPaths() {
  const posts = await getCollection('blog')
  return posts.map(post => ({
    params: { id: post.id },
    props: post,
  }))
}

const post = Astro.props

const { Content, remarkPluginFrontmatter } = await render(post)
const minutesRead = remarkPluginFrontmatter.minutesRead
const lastModifiedTime = dayjs(remarkPluginFrontmatter.lastModified)
  .utc()
  .format('YYYY-MM-DD')

const props = { ...post.data, minutesRead, lastModifiedTime }
---

<BlogPost {...props}>
  <Content />
</BlogPost>
