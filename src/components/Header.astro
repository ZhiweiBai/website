---
import HeaderLink from './HeaderLink.astro'
import { HOMEPAGE_URL } from '../config'
import { IoLogoGithub } from 'react-icons/io5'
import ThemeToggle from './ThemeToggleButton'
import DropdownMenu from './DropdownMenu'
import sjtuLogo from '../images/sjtu-logo.png'

const allPosts = Object.values(
  import.meta.glob('../pages/posts/*.md', { eager: true })
)
const allTags = new Set<string>()
allPosts.map((post: any) => {
  post.frontmatter.tags &&
    post.frontmatter.tags.map((tag: string) => allTags.add(tag))
})
---

<header
  id="main-header"
  class="fixed z-20 w-full p-2 backdrop-blur-md transition-shadow duration-300"
>
  <div class="mx-auto max-w-5xl">
    <nav class="flex items-center gap-3 text-base">
      <a href="/" class="group flex flex-auto items-center">
        <img
          class="h-8 grayscale dark:invert"
          src={sjtuLogo.src}
          alt="SJTU Logo"
        />
        <h2 class="font-mplus p-2 text-lg font-semibold tracking-tighter">
          ZYLab
        </h2>
      </a>
      <div class="hidden items-center gap-6 md:flex">
        <HeaderLink href={HOMEPAGE_URL}>About</HeaderLink>
        <HeaderLink
          href="https://github.com/orgs/zyresearch/repositories"
          target="_blank"><IoLogoGithub />Code</HeaderLink
        >
      </div>
      <div class="flex-1"></div>
      <ThemeToggle client:visible />
      <DropdownMenu client:visible tags={Array.from(allTags)} />
    </nav>
  </div>
</header>

<script>
  function updateHeaderShadow() {
    const header = document.getElementById('main-header')
    if (!header) return

    if (window.scrollY > 0) {
      header.classList.add('shadow-lg')
    } else {
      header.classList.remove('shadow-lg')
    }
  }

  // Update on scroll
  window.addEventListener('scroll', updateHeaderShadow)

  // Update on page load
  document.addEventListener('DOMContentLoaded', updateHeaderShadow)

  // Update immediately if DOM is already loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', updateHeaderShadow)
  } else {
    updateHeaderShadow()
  }
</script>
